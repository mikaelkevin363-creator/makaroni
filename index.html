<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>OPEN PRE-ORDER MAKARONI B2</title>
  <link rel="icon" href="makaroni.png" type="image/png"/>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg1:#e7f9fd; --bg2:#d7f3fb; --card:#fff; --accent:#0d86a9; --muted:#546e73; --price:#026c91;
    }
    *{box-sizing:border-box;font-family:Poppins,system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial;}
    body{margin:0;background:linear-gradient(180deg,var(--bg1),var(--bg2));color:#04303a;padding:18px;}
    .wrap{max-width:1000px;margin:0 auto}
    header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:16px}
    h1{margin:0;color:var(--accent);font-size:22px}
    .lead{color:var(--muted)}
    .card{background:var(--card);border-radius:12px;padding:14px;box-shadow:0 8px 20px rgba(6,29,37,0.06)}
    .seg{display:flex;gap:8px}
    .seg button{border:none;padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:600}
    .seg .active{background:var(--accent);color:#fff}
    .seg .inactive{background:#eef9fb;color:var(--accent)}
    .layout{display:grid;grid-template-columns:1fr 360px;gap:16px;margin-top:12px}
    @media(max-width:980px){.layout{grid-template-columns:1fr}}
    label{display:block;font-weight:600;margin-bottom:6px}
    input[type="text"], input[type="number"], select, textarea{width:100%;padding:10px;border-radius:8px;border:1px solid #d7eef6;background:#fbfeff}
    .variants{margin-top:8px}
    .variant-row{display:flex;justify-content:space-between;align-items:center;padding:10px 6px;border-bottom:1px dashed #eef7fa}
    .small{font-size:13px;color:var(--muted)}
    .qty{width:92px;padding:8px;border-radius:8px;border:1px solid #d7eef6;text-align:center}
    .summary{padding:12px;border-radius:10px;background:linear-gradient(180deg,#f3fcff,#ffffff);border:1px solid #d8eef6}
    .total{font-size:20px;font-weight:700;color:var(--price);margin-top:8px}
    .btn{background:var(--accent);color:#fff;padding:10px 12px;border-radius:10px;border:none;cursor:pointer;font-weight:700;width:100%}
    .wa-btn{display:inline-flex;gap:8px;align-items:center;background:#25D366;color:white;padding:10px 12px;border-radius:10px;text-decoration:none;font-weight:700}
    .file-input{padding:8px;border-radius:8px;border:1px dashed #cdeef8;background:#fbfeff}
    .map iframe{width:100%;height:220px;border-radius:8px;border:0}
    .note{font-size:13px;color:var(--muted);margin-top:6px}
  </style>
</head>
<body>
<div class="wrap">
  <header>
    <div>
      <h1>OPEN PRE-ORDER MAKARONI B2</h1>
      <div class="small lead">All packs Rp 15.000 ‚Äî pilih tipe pesanan, varian, dan jumlah</div>
    </div>
    <div style="text-align:right">
      <a class="wa-btn" id="waTop" href="#" target="_blank">Chat CP ‚Ä¢ 08813893900</a>
    </div>
  </header>

  <div class="card">
    <div style="display:flex;align-items:center;gap:12px;flex-wrap:wrap">
      <div class="seg" role="tablist" aria-label="Tipe Pesanan">
        <button id="tabS" class="seg-btn active" data-type="Sedesian">Sedesian</button>
        <button id="tabR" class="seg-btn inactive" data-type="Reguler">Reguler</button>
      </div>
      <div style="flex:1"></div>
      <div class="small">Contact person: El XIIB2 ‚Ä¢ 08813893900</div>
    </div>

    <div class="layout" style="margin-top:12px">
      <!-- LEFT: FORM -->
      <div>
        <form id="mainForm" class="card" enctype="multipart/form-data">
          <div id="fieldName">
            <label>Nama Pemesan</label>
            <input id="inputName" name="nama" type="text" placeholder="Nama Pemesan" required>

            <div id="fieldB2" style="margin-top:10px">
              <label>Nama Perantara Order (B2)</label>
              <input id="inputB2" name="b2" type="text" placeholder="Nama Anak/Siswa yang menawarkan">
            </div>

            <div id="classRow" style="margin-top:10px">
              <label>Kelas</label>
              <input id="inputClass" name="kelas" type="text" placeholder="e.g. XIIB2">
            </div>
            <div id="addressRow" style="margin-top:10px;display:none">
              <label>Alamat Lengkap</label>
              <textarea id="inputAddress" name="alamat" rows="2" placeholder="Alamat untuk pengiriman"></textarea>
            </div>
          </div>

          <div style="margin-top:12px">
            <label>Daftar Varian (Rp 15.000 / pack) ‚Äî isi qty 0‚Äì10</label>
            <div class="variants" id="variantsList"></div>
          </div>

          <div id="regulerOptions" style="margin-top:12px;display:none">
            <label>Opsi Pengambilan</label>
            <select id="pickupOption" name="pickupOption">
              <option value="pickup">Pickup di SMA Sedes Sapientiae Semarang (12:00)</option>
              <option value="delivery">Kirim ke alamat (harus isi alamat & hubungi CP)</option>
            </select>
          </div>

          <div style="margin-top:12px">
            <label>Metode Pembayaran</label>
            <div id="paymentArea" class="small"></div>

            <div style="margin-top:12px">
              <label>Upload Bukti (wajib jika pilih Transfer)</label>
              <div class="file-input"><input id="proofFile" name="bukti" type="file" accept="image/*,application/pdf" /></div>
            </div>

            <div style="margin-top:12px">
              <label>Catatan (opsional)</label>
              <input id="notes" name="notes" type="text" placeholder="Contoh: ambil lebih awal jika bisa" />
            </div>
          </div>

          <div style="margin-top:12px;display:flex;gap:8px">
            <button type="button" id="btnSubmit" class="btn">Kirim</button>
          </div>
        </form>
      </div>

      <!-- RIGHT: SUMMARY -->
      <aside>
        <div class="summary card">
          <div class="small">Ringkasan Pesanan</div>
          <div id="orderSummary" class="small" style="margin-top:8px">Belum ada item dipilih</div>
          <div class="total" id="orderTotal">Rp 0</div>

          <div style="margin-top:8px" id="rekeningBox"></div>

          <div style="margin-top:12px">
            <button id="btnChat" class="btn" style="background:#25D366">Chat CP via WA</button>
          </div>
        </div>

        <div style="margin-top:12px" class="card map">
          <label>Lokasi Pickup</label>
          <iframe src="https://www.google.com/maps?q=SMA+SEDES+SAPIENTIAE+SEMARANG&output=embed"></iframe>
        </div>
      </aside>
    </div>
  </div>
</div>

<script>
const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzX-LAsmoPUXxJtGlXwbAYPegV_jZRZehmayUVH8kGOkKyE5tyHvJSK0NGvfpzHFX29FA/exec";
const CP_WA_NUMBER = "628813893900";
const PRICE = 15000;
const VARIANTS = ["Original","Spicy","Super Spicy","Balado","BBQ","Keju","Keju Pedas","Sapi Panggang","Sapi Pedas","Jagung Bakar","Jagung Manis","Ayam Lada Hitam","Cokelat","Rumput Laut","Rumput Laut Pedas","Mie Goreng"];

const variantsList = document.getElementById('variantsList');
VARIANTS.forEach(v=>{
  const row=document.createElement('div');
  row.className='variant-row';
  row.innerHTML=`<div><b>${v}</b> <span class="small" style="color:var(--price)">Rp ${PRICE.toLocaleString()}</span></div><input type="number" class="qty" min="0" max="10" value="0" data-variant="${v}"/>`;
  variantsList.appendChild(row);
});

const tabS=document.getElementById('tabS'),tabR=document.getElementById('tabR'),
classRow=document.getElementById('classRow'),addressRow=document.getElementById('addressRow'),
regulerOptions=document.getElementById('regulerOptions'),paymentArea=document.getElementById('paymentArea'),
proofFile=document.getElementById('proofFile'),btnSubmit=document.getElementById('btnSubmit'),
orderSummary=document.getElementById('orderSummary'),orderTotal=document.getElementById('orderTotal'),
btnChat=document.getElementById('btnChat'),waTop=document.getElementById('waTop'),rekeningBox=document.getElementById('rekeningBox');

let currentType='Sedesian';

function showType(t){
  currentType=t;
  tabS.classList.toggle('active',t==='Sedesian');
  tabR.classList.toggle('active',t==='Reguler');
  tabS.classList.toggle('inactive',t!=='Sedesian');
  tabR.classList.toggle('inactive',t!=='Reguler');
  classRow.style.display=t==='Sedesian'?'block':'none';
  addressRow.style.display=t==='Reguler'?'block':'none';
  regulerOptions.style.display=t==='Reguler'?'block':'none';
  renderPaymentOptions(t==='Sedesian'?['Transfer','Cash']:['Transfer']);
  updateSummary();
}

function renderPaymentOptions(list){
  paymentArea.innerHTML='';rekeningBox.innerHTML='';
  list.forEach((m,idx)=>{
    const wrap=document.createElement('div');
    wrap.innerHTML=`<label><input type="radio" name="metode" value="${m}" ${idx===0?'checked':''}/> ${m}</label>`+
      (m==='Transfer'?'<div class="small" style="margin-left:20px;color:var(--price)">üí≥ Transfer ke:<br>‚Ä¢ BCA 4090683361<br>‚Ä¢ MANDIRI 1360036725569<br>a.n. <b>Mikael Kevin Kurnia</b></div>':'');
    paymentArea.appendChild(wrap);
  });
}

function gatherItems(){
  const items=[];
  document.querySelectorAll('.qty').forEach(i=>{
    const q=+i.value;
    if(q>0)items.push({variant:i.dataset.variant,qty:q});
  });
  return items;
}

function updateSummary(){
  const items=gatherItems();
  if(items.length===0){orderSummary.textContent='Belum ada item dipilih';orderTotal.textContent='Rp 0';return;}
  const total=items.reduce((s,it)=>s+it.qty*PRICE,0);
  orderSummary.textContent=items.map(it=>`${it.variant} x${it.qty}`).join(', ');
  orderTotal.textContent='Rp '+total.toLocaleString('id-ID');
}

tabS.onclick=()=>showType('Sedesian');
tabR.onclick=()=>showType('Reguler');
document.addEventListener('input',e=>{if(e.target.classList.contains('qty'))updateSummary();});
btnChat.onclick=()=>window.open('https://wa.me/'+CP_WA_NUMBER,'_blank');
waTop.href='https://wa.me/'+CP_WA_NUMBER;

btnSubmit.onclick=async()=>{
  const nama=inputName.value.trim(),b2=inputB2.value.trim(),kelas=inputClass.value.trim(),alamat=inputAddress.value.trim(),
  notes=document.getElementById('notes').value.trim(),metode=document.querySelector('input[name="metode"]:checked').value,
  items=gatherItems(),proof=proofFile.files[0];
  if(!nama)return alert('Isi nama pemesan.');
  if(items.length===0)return alert('Pilih minimal 1 varian.');
  if(metode==='Transfer'&&!proof)return alert('Upload bukti transfer.');
  const total=items.reduce((s,it)=>s+it.qty*PRICE,0);
  const fd=new FormData();
  fd.append('nama',nama);fd.append('b2',b2);
  fd.append('kelasAlamat',currentType==='Sedesian'?kelas:alamat);
  fd.append('tipe',currentType);
  fd.append('pesanan',items.map(it=>`${it.variant} x${it.qty}`).join('; '));
  fd.append('total',total);fd.append('metode',metode);fd.append('notes',notes||'');
  if(proof)fd.append('bukti',proof,proof.name);
  await fetch(APPS_SCRIPT_URL,{method:'POST',body:fd});
  const pesanWA=`[PESAN ${currentType.toUpperCase()}]%0A`+
    `Halo Kak, saya ingin pesan Makaroni:%0A‚Ä¢ Nama: ${nama}%0A‚Ä¢ Nama Perantara: ${b2||'-'}%0A‚Ä¢ ${currentType==='Sedesian'?'Kelas':'Alamat'}: ${currentType==='Sedesian'?kelas:alamat||'-'}%0A‚Ä¢ Pesanan: ${items.map(it=>it.variant+' x'+it.qty).join(', ')}%0A‚Ä¢ Total: Rp ${total.toLocaleString('id-ID')}%0A‚Ä¢ Metode: ${metode}%0A‚Ä¢ Catatan: ${notes||'-'}%0A%0ATerima kasih! üôè Pesanan kamu sudah terkirim. Silakan tunggu konfirmasi dari CP.`;
  if((metode==='Cash'&&currentType==='Sedesian')||currentType==='Reguler'){
    window.open('https://wa.me/'+CP_WA_NUMBER+'?text='+pesanWA,'_blank');
    alert('Pesanan terkirim dan WA dibuka ‚úÖ');
  }else alert('Pesanan terkirim ‚úÖ Silakan tunggu konfirmasi CP.');
  mainForm.reset();updateSummary();
};
showType('Sedesian');updateSummary();
</script>
</body>
</html>
