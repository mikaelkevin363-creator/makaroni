<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>OPEN PRE-ORDER MAKARONI</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
<style>
/* ... semua CSS sama seperti codingmu sebelumnya ... */
</style>
</head>
<body>
<div class="wrap">
  <!-- Header & Form sama persis seperti codingmu -->
</div>

<script>
const APPS_SCRIPT_URL = "YOUR_APPS_SCRIPT_URL_HERE"; // ganti sesuai milikmu
const CP_WA_NUMBER = "628813893900";
const PRICE = 15000;
const VARIANTS = ["Original","Spicy","Super Spicy","Balado","BBQ","Keju","Keju Pedas","Sapi Panggang","Sapi Pedas","Jagung Bakar","Jagung Manis","Ayam Lada Hitam","Cokelat","Rumput Laut","Rumput Laut Pedas","Mie Goreng"];

const variantsList = document.getElementById('variantsList');
VARIANTS.forEach(v => {
  const row = document.createElement('div');
  row.className = 'variant-row';
  row.innerHTML = `
    <div style="display:flex;gap:12px;align-items:center">
      <div style="font-weight:600">${v}</div>
      <div class="small" style="margin-left:6px;color:var(--price)">Rp ${PRICE.toLocaleString()}</div>
    </div>
    <div><input type="number" class="qty" min="0" max="10" value="0" data-variant="${v}" /></div>
  `;
  variantsList.appendChild(row);
});

const tabS=document.getElementById('tabS'),tabR=document.getElementById('tabR'),
classRow=document.getElementById('classRow'),addressRow=document.getElementById('addressRow'),
regulerOptions=document.getElementById('regulerOptions'),paymentArea=document.getElementById('paymentArea'),
proofFile=document.getElementById('proofFile'),btnSubmit=document.getElementById('btnSubmit'),
orderSummary=document.getElementById('orderSummary'),orderTotal=document.getElementById('orderTotal');

let currentType='Sedesian';

function showType(type){
  currentType=type;
  if(type==='Sedesian'){
    tabS.classList.add('active'); tabS.classList.remove('inactive');
    tabR.classList.remove('active'); tabR.classList.add('inactive');
    classRow.style.display='block'; addressRow.style.display='none'; regulerOptions.style.display='none';
    renderPaymentOptions(['Transfer','Cash']);
  } else {
    tabR.classList.add('active'); tabR.classList.remove('inactive');
    tabS.classList.remove('active'); tabS.classList.add('inactive');
    classRow.style.display='none'; addressRow.style.display='block'; regulerOptions.style.display='block';
    renderPaymentOptions(['Transfer']);
  }
  updateSummary();
}

function renderPaymentOptions(list){
  paymentArea.innerHTML='';
  list.forEach((m,idx)=>{
    const wrap=document.createElement('div');
    wrap.style.marginBottom='6px';
    wrap.innerHTML=`
      <label style="display:flex;align-items:center;gap:6px">
        <input type="radio" name="metode" value="${m}" ${idx===0?'checked':''}> ${m}
      </label>
      ${m==='Transfer'?'<div class="small" style="margin-left:22px;color:var(--price)">ðŸ’³ Transfer ke: <br>â€¢ BCA 4090683361<br>â€¢ MANDIRI 1360036725569<br>a.n. <b>Mikael Kevin Kurnia</b></div>':'<div class="small" style="margin-left:22px;color:var(--muted)">ðŸ’¬ Jika membayar Cash, hubungi CP.</div>'}
    `;
    paymentArea.appendChild(wrap);
  });
}

function gatherItems(){
  const inputs=document.querySelectorAll('.qty'); const items=[];
  inputs.forEach(i=>{ const q=Number(i.value)||0; if(q>0){ items.push({variant:i.dataset.variant, qty:q, price:PRICE}); }});
  return items;
}

function updateSummary(){
  const items=gatherItems();
  if(items.length===0){ orderSummary.textContent='Belum ada item dipilih'; orderTotal.textContent='Rp 0'; return; }
  const lines=items.map(it=>`${it.variant} x${it.qty}`);
  const total=items.reduce((s,it)=>s+it.qty*it.price,0);
  orderSummary.textContent=lines.join(', ');
  orderTotal.textContent='Rp '+total.toLocaleString('id-ID');
}

tabS.onclick=()=>showType('Sedesian');
tabR.onclick=()=>showType('Reguler');
document.addEventListener('input', e=>{ if(e.target.classList.contains('qty')){ let v=Number(e.target.value)||0; if(v<0)v=0;if(v>10)v=10;e.target.value=v; updateSummary(); }});

btnSubmit.onclick=async()=>{
  const nama=document.getElementById('inputName').value.trim(),
        kelas=document.getElementById('inputClass').value.trim(),
        alamat=document.getElementById('inputAddress').value.trim(),
        pickupOpt=document.getElementById('pickupOption')?document.getElementById('pickupOption').value:null,
        notes=document.getElementById('notes').value.trim();
  
  if(!nama)return alert('Silakan isi nama.');
  if(currentType==='Sedesian'&&!kelas)return alert('Silakan isi kelas.');
  if(currentType==='Reguler'&&pickupOpt==='delivery'&&!alamat)return alert('Silakan isi alamat.');

  const items=gatherItems(); if(items.length===0)return alert('Pilih minimal 1 varian.');
  const metodeRadio=document.querySelector('input[name="metode"]:checked'); if(!metodeRadio)return alert('Pilih metode pembayaran.');
  const metode=metodeRadio.value, proofFileObj=proofFile.files[0];
  if(metode==='Transfer'&&!proofFileObj)return alert('Upload bukti transfer.');

  const orderLines=items.map(it=>`${it.variant} x${it.qty}`); const total=items.reduce((s,it)=>s+it.qty*it.price,0);

  const fd=new FormData();
  fd.append('nama', nama);
  fd.append('kelas_or_address', currentType==='Sedesian'?kelas:alamat);
  fd.append('tipe', currentType);
  fd.append('pesanan', orderLines.join('; '));
  fd.append('total', total);
  fd.append('metode', metode);
  fd.append('notes', notes || '');
  if(proofFileObj) fd.append('bukti', proofFileObj, proofFileObj.name);

  try{ await fetch(APPS_SCRIPT_URL,{method:'POST',body:fd}); }
  catch(err){ return alert('Gagal kirim data.'); }

  alert('âœ… Pesanan terkirim!');
  document.getElementById('mainForm').reset();
  updateSummary();
};

showType('Sedesian');
updateSummary();
</script>
</body>
</html>
