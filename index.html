<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>OPEN PRE-ORDER MAKARONI</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
<style>
/* ... tetap gunakan CSS lama dari formmu ... */
</style>
</head>
<body>
<div class="wrap">
<header>
  <div>
    <h1>OPEN PRE-ORDER MAKARONI</h1>
    <div class="small lead">All packs Rp 15.000 — pilih tipe pesanan, varian, dan jumlah</div>
  </div>
  <div style="text-align:right">
    <a class="wa-btn" id="waTop" href="#" target="_blank">Chat CP • 08813893900</a>
  </div>
</header>

<div class="card">
<div style="display:flex;align-items:center;gap:12px;flex-wrap:wrap">
  <div class="seg" role="tablist" aria-label="Tipe Pesanan">
    <button id="tabS" class="seg-btn active" data-type="Sedesian">Sedesian</button>
    <button id="tabR" class="seg-btn inactive" data-type="Reguler">Reguler</button>
  </div>
  <div style="flex:1"></div>
  <div class="small">Contact person: El XIIB2 • 08813893900</div>
</div>

<div class="layout" style="margin-top:12px">
<div>
  <form id="mainForm" class="card">
    <div id="fieldName">
      <label>Nama Lengkap</label>
      <input id="inputName" type="text" placeholder="Nama lengkap" required>
      <div id="classRow" style="margin-top:10px">
        <label>Kelas</label>
        <input id="inputClass" type="text" placeholder="e.g. XIIB2">
      </div>
      <div id="addressRow" style="margin-top:10px;display:none">
        <label>Alamat Lengkap</label>
        <textarea id="inputAddress" rows="2" placeholder="Alamat untuk pengiriman"></textarea>
        <div class="note">Jika pilih delivery, hubungi CP untuk konfirmasi ongkir.</div>
      </div>
    </div>

    <div style="margin-top:12px">
      <label>Daftar Varian (Rp 15.000 / pack) — isi qty 0–10</label>
      <div class="variants" id="variantsList"></div>
      <div class="note">Max qty per variant: 10</div>
    </div>

    <div id="regulerOptions" style="margin-top:12px;display:none">
      <label>Opsi Pengambilan</label>
      <select id="pickupOption">
        <option value="pickup">Pickup di SMA Sedes Sapientiae Semarang (12:00)</option>
        <option value="delivery">Kirim ke alamat</option>
      </select>
    </div>

    <div style="margin-top:12px">
      <label>Metode Pembayaran</label>
      <div id="paymentArea" class="small"></div>

      <div style="margin-top:12px">
        <label>Upload Bukti (wajib jika pilih Transfer)</label>
        <div class="file-input"><input id="proofFile" name="bukti" type="file" accept="image/*,application/pdf" /></div>
      </div>

      <div style="margin-top:12px">
        <label>Catatan (opsional)</label>
        <input id="notes" type="text" placeholder="Contoh: ambil lebih awal jika bisa" />
      </div>
    </div>

    <div style="margin-top:12px;display:flex;gap:8px">
      <button type="button" id="btnSubmit" class="btn">Kirim</button>
    </div>
  </form>
</div>

<aside>
<div class="summary card">
  <div class="small">Ringkasan Pesanan</div>
  <div id="orderSummary" class="small" style="margin-top:8px">Belum ada item dipilih</div>
  <div class="total" id="orderTotal">Rp 0</div>

  <div style="margin-top:12px">
    <button id="btnChat" class="btn" style="background:#25D366">Chat CP via WA</button>
  </div>
</div>
</aside>
</div>
</div>
</div>

<script>
const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxz8XGmPdqYolRlmHyZxredVHKB0GUrSJIYhlT9QZx2/dev";
const CP_WA_NUMBER = "628813893900";
const PRICE = 15000;
const VARIANTS = ["Original","Spicy","Super Spicy","Balado","BBQ","Keju","Keju Pedas","Sapi Panggang","Sapi Pedas",
"Jagung Bakar","Jagung Manis","Ayam Lada Hitam","Cokelat","Rumput Laut","Rumput Laut Pedas","Mie Goreng"];

const variantsList = document.getElementById('variantsList');
VARIANTS.forEach(v => {
  const row = document.createElement('div');
  row.className = 'variant-row';
  row.innerHTML = `
    <div style="display:flex;gap:12px;align-items:center">
      <div style="font-weight:600">${v}</div>
      <div class="small" style="margin-left:6px;color:var(--price)">Rp ${PRICE.toLocaleString()}</div>
    </div>
    <div><input type="number" class="qty" min="0" max="10" value="0" data-variant="${v}" /></div>
  `;
  variantsList.appendChild(row);
});

const tabS=document.getElementById('tabS'),tabR=document.getElementById('tabR'),
classRow=document.getElementById('classRow'),addressRow=document.getElementById('addressRow'),
regulerOptions=document.getElementById('regulerOptions'),paymentArea=document.getElementById('paymentArea'),
proofFile=document.getElementById('proofFile'),btnSubmit=document.getElementById('btnSubmit'),
orderSummary=document.getElementById('orderSummary'),orderTotal=document.getElementById('orderTotal'),
btnChat=document.getElementById('btnChat'),waTop=document.getElementById('waTop');

let currentType='Sedesian';

function showType(type){
  currentType=type;
  if(type==='Sedesian'){
    tabS.classList.add('active');tabS.classList.remove('inactive');
    tabR.classList.remove('active');tabR.classList.add('inactive');
    classRow.style.display='block';addressRow.style.display='none';regulerOptions.style.display='none';
    renderPaymentOptions(['Transfer','Cash']);
  }else{
    tabR.classList.add('active');tabR.classList.remove('inactive');
    tabS.classList.remove('active');tabS.classList.add('inactive');
    classRow.style.display='none';addressRow.style.display='block';regulerOptions.style.display='block';
    renderPaymentOptions(['Transfer']);
  }
  updateSummary();
}

function renderPaymentOptions(list){
  paymentArea.innerHTML='';
  list.forEach((m,idx)=>{
    const wrap=document.createElement('div');
    wrap.style.marginBottom='6px';
    wrap.innerHTML=`
      <label style="display:flex;align-items:center;gap:6px">
        <input type="radio" name="metode" value="${m}" ${idx===0?'checked':''}> ${m}
      </label>
    `;
    paymentArea.appendChild(wrap);
  });
}

function gatherItems(){
  const inputs=document.querySelectorAll('.qty');const items=[];
  inputs.forEach(i=>{const q=Number(i.value)||0;if(q>0){items.push({variant:i.dataset.variant,qty:q,price:PRICE});}});
  return items;
}

function updateSummary(){
  const items=gatherItems();
  if(items.length===0){orderSummary.textContent='Belum ada item dipilih';orderTotal.textContent='Rp 0';return;}
  const lines=items.map(it=>`${it.variant} x${it.qty}`);
  const total=items.reduce((s,it)=>s+it.qty*it.price,0);
  orderSummary.textContent=lines.join(', ');
  orderTotal.textContent='Rp '+total.toLocaleString('id-ID');
}

tabS.onclick=()=>showType('Sedesian');tabR.onclick=()=>showType('Reguler');
document.addEventListener('input',e=>{if(e.target.classList.contains('qty')){let v=Number(e.target.value)||0;if(v<0)v=0;if(v>10)v=10;e.target.value=v;updateSummary();}});
btnChat.onclick=()=>window.open('https://wa.me/'+CP_WA_NUMBER,'_blank');
waTop.href='https://wa.me/'+CP_WA_NUMBER;

btnSubmit.onclick=async()=>{
  const nama=document.getElementById('inputName').value.trim(),
        kelas=document.getElementById('inputClass').value.trim(),
        alamat=document.getElementById('inputAddress').value.trim(),
        pickupOpt=document.getElementById('pickupOption')?document.getElementById('pickupOption').value:null,
        notes=document.getElementById('notes').value.trim();

  if(!nama)return alert('Silakan isi nama.');
  if(currentType==='Sedesian'&&!kelas)return alert('Silakan isi kelas.');
  if(currentType==='Reguler'&&pickupOpt==='delivery'&&!alamat)return alert('Silakan isi alamat.');

  const items=gatherItems();if(items.length===0)return alert('Pilih minimal 1 varian.');
  const metodeRadio=document.querySelector('input[name="metode"]:checked');if(!metodeRadio)return alert('Pilih metode pembayaran.');
  const metode=metodeRadio.value, proofFileObj=proofFile.files[0];

  const orderLines=items.map(it=>`${it.variant} x${it.qty}`);
  const total=items.reduce((s,it)=>s+it.qty*it.price,0);
  const totalRp=total.toLocaleString('id-ID');

  // FormData dikirim ke Apps Script
  const fd = new FormData();
  fd.append('nama', nama);
  fd.append('kelas', currentType==='Sedesian'?kelas:"");
  fd.append('alamat', currentType==='Reguler'&&(pickupOpt==='delivery')?alamat:"");
  fd.append('tipe', currentType);
  fd.append('pesanan', orderLines.join('; '));
  fd.append('total', total);
  fd.append('metode', metode);
  fd.append('notes', notes || '');
  if(proofFileObj){
    // kasih nama file sesuai nama pelanggan
    const ext = proofFileObj.name.split('.').pop();
    fd.append('bukti', new File([proofFileObj], `TF_${nama}.${ext}`, {type: proofFileObj.type}));
  }

  await fetch(APPS_SCRIPT_URL,{method:'POST', body: fd});

  if(metode==='Cash'){
    const pesan=`Halo Kak, saya ingin pesan Makaroni:%0A• Nama: ${nama}%0A• Kelas: ${kelas}%0A• Alamat: ${alamat}%0A• Tipe: ${currentType}%0A• Pesanan: ${orderLines.join(', ')}%0A• Total Qty: ${items.reduce((a,b)=>a+b.qty,0)} pack%0A• Total Harga: Rp ${totalRp}%0A• Metode: Cash%0A• Catatan: ${notes||'-'}`;
    window.open('https://wa.me/'+CP_WA_NUMBER+'?text='+pesan,'_blank');
    alert('Pesanan terkirim! WA ke CP telah dibuka.');
    document.getElementById('mainForm').reset();updateSummary();return;
  }

  alert(`✅ Pesanan terkirim!\n\nNama: ${nama}\nKelas: ${kelas}\nAlamat: ${alamat}\nTipe: ${currentType}\nPesanan: ${orderLines.join(', ')}\nTotal: Rp ${totalRp}\nMetode: ${metode}`);
  document.getElementById('mainForm').reset();updateSummary();
};

showType('Sedesian');
updateSummary();
</script>
</body>
</html>
